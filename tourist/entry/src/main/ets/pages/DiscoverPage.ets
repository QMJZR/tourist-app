// entry/src/main/ets/pages/DiscoverPage.ets
import router from '@ohos.router';

// åŠŸèƒ½é¡¹æ¥å£ï¼ˆä¸ProfilePageä¿æŒä¸€è‡´ï¼‰
interface DiscoverFunctionItem {
  id: string;
  icon: string;
  title: string;
  subtitle?: string;
  showArrow: boolean;
  route?: string;
}

@Entry
@Component
export default struct DiscoverPage {
  // å‘ç°åŠŸèƒ½åˆ—è¡¨ï¼ˆä¸¤æ¡åŠŸèƒ½ï¼Œç»“æ„ä¸ProfilePageä¿æŒä¸€è‡´ï¼‰
  @State functionList: DiscoverFunctionItem[] = [
    {
      id: 'ranking',
      icon: 'ğŸ†',
      title: 'æ’è¡Œæ¦œ',
      subtitle: 'æŸ¥çœ‹çƒ­é—¨æ™¯ç‚¹ä¸æ‰“å¡è¾¾äºº',
      showArrow: true,
      route: 'pages/RankPage'
    },
    {
      id: 'feeds',
      icon: 'ğŸ“',
      title: 'åŠ¨æ€',
      subtitle: 'æµè§ˆä¸åˆ†äº«æ—…è¡Œæ—¶åˆ»',
      showArrow: true,
      route: 'pages/FeedListPage'
    }
  ];

  // å…¶ä»–å‘ç°åŠŸèƒ½ï¼ˆå¯åç»­æ‰©å±•ï¼‰
  @State otherFunctions: DiscoverFunctionItem[] = [
    {
      id: 'nearby',
      icon: 'ğŸ“',
      title: 'é™„è¿‘æ¨è',
      subtitle: 'å‘ç°å‘¨å›´çš„ç²¾å½©æ™¯ç‚¹',
      showArrow: true,
      route: 'pages/NearbyPage'
    }
  ];

  // ==================== æ„å»ºæ–¹æ³• ====================
  build() {
    Column() {
      // 1. é¡¶éƒ¨æ ‡é¢˜å¡ç‰‡
      this.buildTitleCard()

      // 2. ä¸»è¦åŠŸèƒ½åˆ—è¡¨ï¼ˆä¸¤æ¡åŠŸèƒ½ï¼‰
      this.buildFunctionList()

      // 3. å…¶ä»–åŠŸèƒ½åˆ—è¡¨
      this.buildOtherFunctions()

      // 4. åº•éƒ¨å®‰å…¨åŒºåŸŸå ä½
      Row()
        .height(60)
        .width('100%')
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  // ==================== é¡¶éƒ¨æ ‡é¢˜å¡ç‰‡ï¼ˆç±»ä¼¼ä¸ªäººä¿¡æ¯å¡ç‰‡ï¼‰ ====================
  @Builder
  buildTitleCard() {
    Column() {
      // æ ‡é¢˜å¡ç‰‡ - ç™½è‰²è®¾è®¡
      Column({ space: 20 }) {
        // å›¾æ ‡å’Œæ ‡é¢˜è¡Œ
        Row({ space: 15 }) {
          // å·¦ä¾§å‘ç°å›¾æ ‡
          Column() {
            Text('ğŸ”')
              .fontSize(40)
              .width(80)
              .height(80)
              .textAlign(TextAlign.Center)
              .backgroundColor('#F0F7FF')
              .borderRadius(40)
          }
          .width(80)
          .height(80)

          // å³ä¾§æ ‡é¢˜ä¿¡æ¯
          Column({ space: 8 }) {
            // ä¸»æ ‡é¢˜
            Text('å‘ç°')
              .fontSize(24)
              .fontWeight(FontWeight.Bold)
              .fontColor('#333333')
              .textAlign(TextAlign.Start)
              .width('100%')

            // å‰¯æ ‡é¢˜
            Text('æ¢ç´¢æ›´å¤šç²¾å½©å†…å®¹')
              .fontSize(15)
              .fontColor('#666666')
              .textAlign(TextAlign.Start)
              .width('100%')
          }
          .layoutWeight(1) // å æ®å‰©ä½™ç©ºé—´
        }
        .width('100%')
        .padding({ left: 20, right: 20, top: 25, bottom: 25 })
      }
      .width('100%')
      .backgroundColor(Color.White)
      .borderRadius(12)
      .shadow({ radius: 4, color: '#00000008' })
      .margin({ left: 15, right: 15, top: 15, bottom: 20 })
    }
    .width('100%')
  }

  // ==================== åŠŸèƒ½åˆ—è¡¨ï¼ˆä¸ProfilePageå®Œå…¨ç›¸åŒï¼‰ ====================
  @Builder
  buildFunctionList() {
    Column() {
      ForEach(this.functionList, (item: DiscoverFunctionItem) => {
        this.buildFunctionItem(item)
      })
    }
    .backgroundColor(Color.White)
    .borderRadius(12)
    .margin({ left: 15, right: 15, bottom: 15 })
    .shadow({ radius: 4, color: '#00000008' })
  }

  @Builder
  buildOtherFunctions() {
    Column() {
      ForEach(this.otherFunctions, (item: DiscoverFunctionItem) => {
        this.buildFunctionItem(item)
      })
    }
    .backgroundColor(Color.White)
    .borderRadius(12)
    .margin({ left: 15, right: 15, bottom: 15 })
    .shadow({ radius: 4, color: '#00000008' })
  }

  @Builder
  buildFunctionItem(item: DiscoverFunctionItem) {
    Column() {
      Row({ space: 12 }) {
        // å·¦ä¾§å›¾æ ‡
        Text(item.icon)
          .fontSize(20)
          .width(24)
          .textAlign(TextAlign.Center)

        // æ ‡é¢˜å’Œå‰¯æ ‡é¢˜
        Column({ space: 2 }) {
          Text(item.title)
            .fontSize(16)
            .fontColor('#333333')
            .textAlign(TextAlign.Start)
            .width('100%')

          if (item.subtitle) {
            Text(item.subtitle)
              .fontSize(13)
              .fontColor('#666666')
              .textAlign(TextAlign.Start)
              .width('100%')
          }
        }
        .layoutWeight(1) // å æ®å‰©ä½™ç©ºé—´

        // å³ä¾§ç®­å¤´
        if (item.showArrow) {
          Text('â€º')
            .fontSize(20)
            .fontColor('#999999')
            .margin({ right: 5 })
        }
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 12 })
      .backgroundColor(Color.White)
      .onClick(() => {
        this.onFunctionItemClick(item);
      })

      // åˆ†éš”çº¿ï¼ˆä¸ProfilePageç›¸åŒçš„é€»è¾‘ï¼‰
      if (item.id !== this.functionList[this.functionList.length - 1]?.id &&
        item.id !== this.otherFunctions[this.otherFunctions.length - 1]?.id) {
        Divider()
          .color('#F0F0F0')
          .margin({ left: 52, right: 0 })
          .strokeWidth(0.5)
      }
    }
  }

  // ==================== ç‚¹å‡»äº‹ä»¶å¤„ç†ï¼ˆä¸ProfilePageç»“æ„ç›¸åŒï¼‰ ====================
  private onFunctionItemClick(item: DiscoverFunctionItem): void {
    console.log(`ç‚¹å‡»å‘ç°åŠŸèƒ½é¡¹: ${item.title} (ID: ${item.id})`);

    switch (item.id) {
      case 'ranking':
        this.onRankingClick();
        break;
      case 'feeds':
        this.onFeedsClick();
        break;
      case 'nearby':
        this.onNearbyClick();
        break;
    }

    // å¦‚æœæœ‰è·¯ç”±é…ç½®ï¼Œåˆ™æ‰§è¡Œè·³è½¬
    if (item.route) {
      console.log(`å‡†å¤‡è·³è½¬åˆ°: ${item.route}`);
      const jumpPromise: Promise<void> = router.pushUrl({
        url: item.route
      });
      jumpPromise.then((): void => {
        console.log(`æˆåŠŸè·³è½¬åˆ°${item.title}é¡µé¢`);
      }).catch((error: Error): void => {
        console.error(`è·³è½¬å¤±è´¥: ${error.message}`);
      });
    }
  }

  // æ’è¡Œæ¦œç‚¹å‡»
  private onRankingClick(): void {
    console.log('ç‚¹å‡»æ’è¡Œæ¦œ');
  }

  // åŠ¨æ€ç‚¹å‡»
  private onFeedsClick(): void {
    console.log('ç‚¹å‡»åŠ¨æ€');
    router.pushUrl({
      url:"pages/FeedListPage"
    })
  }

  // é™„è¿‘æ¨èç‚¹å‡»
  private onNearbyClick(): void {
    console.log('ç‚¹å‡»é™„è¿‘æ¨è');
  }

  // ==================== ç”Ÿå‘½å‘¨æœŸæ–¹æ³• ====================
  aboutToAppear() {
    console.log('å‘ç°é¡µé¢æ˜¾ç¤º');
  }

  aboutToDisappear() {
    console.log('å‘ç°é¡µé¢éšè—');
  }
}